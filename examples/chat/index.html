<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Calfkit</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
      height: 100%;
      -webkit-text-size-adjust: 100%;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      display: flex;
      flex-direction: column;
      min-height: 100dvh;
      background: #f5f5f5;
    }

    header {
      padding: 16px;
      text-align: center;
      font-size: 24px;
      font-weight: 700;
    }

    main {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 16px;
    }

    .chat-container {
      width: 100%;
      max-width: 480px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    label {
      font-size: 14px;
      font-weight: 600;
      color: #333;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    input, textarea {
      width: 100%;
      padding: 14px 16px;
      font-size: 16px;
      font-family: inherit;
      border: 1px solid #ccc;
      border-radius: 8px;
      outline: none;
      -webkit-appearance: none;
      appearance: none;
    }

    textarea {
      resize: vertical;
      min-height: 100px;
    }

    input:focus, textarea:focus {
      border-color: #333;
    }

    #send-btn {
      width: 100%;
      padding: 14px 24px;
      font-size: 16px;
      background: #111;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    #send-btn:active {
      background: #333;
    }

    #send-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    #status {
      font-size: 14px;
      color: #666;
      min-height: 20px;
      text-align: center;
    }

    #status.error { color: #c00; }

    footer {
      padding: 16px;
      text-align: center;
      font-size: 14px;
    }

    footer a {
      color: #333;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <header>üêÆ Calfkit</header>
  <main>
    <div class="chat-container">
      <div class="field">
        <label for="group-id">New Name</label>
        <input type="text" id="group-id" placeholder="e.g. my-agent-group" autofocus>
      </div>
      <div class="field">
        <label for="system-prompt">System Prompt</label>
        <textarea id="system-prompt" placeholder="Enter a system prompt..."></textarea>
      </div>
      <button id="send-btn" disabled>Dispatch</button>
      <div id="status"></div>
    </div>
  </main>
  <footer><a href="https://github.com/calf-ai/calfkit-sdk">‚≠êÔ∏è on GitHub!</a></footer>

  <script>
    const API_URL = window.API_URL || "http://localhost:8000/publish/dispatch_request";

    const groupIdInput = document.getElementById("group-id");
    const systemPromptInput = document.getElementById("system-prompt");
    const btn = document.getElementById("send-btn");
    const status = document.getElementById("status");

    async function send() {
      const groupId = groupIdInput.value.trim();
      const systemPrompt = systemPromptInput.value.trim();
      if (!groupId || !systemPrompt) return;

      btn.disabled = true;
      status.className = "";
      status.textContent = "Sending...";

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ group_id: groupId, system_prompt: systemPrompt }),
        });

        if (!res.ok) throw new Error(`HTTP ${res.status}`);

        systemPromptInput.value = "";
        status.textContent = "Dispatched!";
      } catch (err) {
        status.className = "error";
        status.textContent = `Failed: ${err.message}`;
      } finally {
        updateBtn();
      }
    }

    function updateBtn() {
      btn.disabled = !groupIdInput.value.trim() || !systemPromptInput.value.trim();
    }

    groupIdInput.addEventListener("input", updateBtn);
    systemPromptInput.addEventListener("input", updateBtn);
    btn.addEventListener("click", send);
  </script>
</body>
</html>
